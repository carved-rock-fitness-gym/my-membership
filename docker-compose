version: '3.8'

services:
  test:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      target: test
    environment:
      - NODE_ENV=test
      - JEST_WORKERS=4
      - COVERAGE=true
    volumes:
      - ./coverage:/app/coverage
      - ./test-results:/app/test-results
    command: npm run test:ci

  integration:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      target: test
    environment:
      - NODE_ENV=test
      - TEST_RETRY=3
    volumes:
      - ./test-results:/app/test-results
    command: npm run test:integration

  performance:
    image: grafana/k6
    volumes:
      - ./load-tests:/scripts
    command: run /scripts/load-test.js